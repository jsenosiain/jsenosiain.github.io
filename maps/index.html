<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=650, user-scalable=yes">

        <script src='https://api.mapbox.com/mapbox-gl-js/v0.36.0/mapbox-gl.js'></script>
        <script src="https://www.gstatic.com/firebasejs/4.1.1/firebase.js"></script>
        
        <link href='https://api.mapbox.com/mapbox-gl-js/v0.36.0/mapbox-gl.css' rel='stylesheet' />
        <link href='style.css' rel='stylesheet' />
    </head>
    <body>
        <div id='map' style='width: 645px; height: 645px;'></div>
        <script>
            mapboxgl.accessToken = 'pk.eyJ1Ijoiam9hY28xODIiLCJhIjoiY2ozZXM1czd6MDBvcjJxcWwzOGJ2YWd1eCJ9.qiyNenOg-m3Ike7KoTuTNg';
            
            var options = {
                container: 'map',
                style: 'mapbox://styles/mapbox/satellite-streets-v9',
                center: [-116.9941444, 32.6682625],
                zoom: 20
            };

            var map = new mapboxgl.Map(options);            
            var marker, popup;

            map.on('load', () => {
                navigator.geolocation.getCurrentPosition(position => {
                    var el = document.createElement('div');
                        el.className = 'marker';
                        el.style.width = '24px';
                        el.style.height = '24px';
                        
                        map.setCenter([position.coords.longitude, position.coords.latitude]);
                        
                        marker = new mapboxgl.Marker(el);
                        popup = new mapboxgl.Popup({
                            closeButton: false
                        })
                        .setHTML(`Lat: ${position.coords.latitude}, Lng: ${position.coords.longitude}`);

                        marker
                            .setLngLat([position.coords.longitude, position.coords.latitude])
                            .setPopup(popup)
                            .addTo(map)
                            .togglePopup();
                });

                navigator.geolocation.watchPosition(position => {
                    marker
                        .setLngLat([position.coords.longitude, position.coords.latitude]);

                    popup
                        .setLngLat([position.coords.longitude, position.coords.latitude])
                        .setHTML(`Lat: ${position.coords.latitude}, Lng: ${position.coords.longitude}`);

                },
                error => {},
                {
                    enableHighAccuracy: true
                });
            });
            
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyA1Rga3Zat2jhREg6yx5DG9iNEOtC1L77c",
                authDomain: "where-are-we-8ef31.firebaseapp.com",
                databaseURL: "https://where-are-we-8ef31.firebaseio.com",
                projectId: "where-are-we-8ef31",
                storageBucket: "where-are-we-8ef31.appspot.com",
                messagingSenderId: "749631421590"
            };
            
            var firebase = firebase.initializeApp(config);

            // on geolocation change, update firebase

            // on firebase update notification, update display
        </script>
        
    </body>
</html>